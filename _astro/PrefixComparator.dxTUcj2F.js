import{d as J,o as g,c as v,a as e,w as S,v as D,b as T,e as w,t as l,F as I,r as F,f as C,g as u,h as B}from"./runtime-dom.esm-bundler.csOh2WLt.js";import{_ as A}from"./_plugin-vue_export-helper.x3n3nnut.js";const W=J({__name:"PrefixComparator",props:{prefix_json_url1:{default:"/babel-validation/prefix_reports/prefix_report-2024oct24.json"},prefix_json_url2:{default:"/babel-validation/prefix_reports/prefix_report-dev-2025jan23.json"}},setup(P,{expose:d}){d();const x=P,s=C(!1),m=C("{}"),b=C("{}"),o=u(()=>JSON.parse(m.value)),p=u(()=>JSON.parse(b.value)),N=u(()=>o.value.name||"Prefix Report 1"),U=u(()=>p.value.name||"Prefix Report 2");B(()=>{x.prefix_json_url1&&fetch(x.prefix_json_url1).then(i=>i.json()).then(i=>m.value=JSON.stringify(i,null,2)),x.prefix_json_url2&&fetch(x.prefix_json_url2).then(i=>i.json()).then(i=>b.value=JSON.stringify(i,null,2))});class k{clique_leader_prefix;filename;prefix;prefix_count;constructor(r,n,t,f){this.clique_leader_prefix=r,this.filename=n,this.prefix=t,this.prefix_count=f}}function y(i){return"by_clique"in i?Object.entries(i.by_clique).flatMap(r=>{const n=r[0],t=r[1];if(n.startsWith("count_"))return[];if("by_file"in t){const f=n;return Object.entries(t.by_file).flatMap(c=>{const a=c[0],_=c[1];return Object.entries(_).map(h=>{const O=h[1];return new k(f,a,h[0],O)})})}else return[]}):[]}const L=u(()=>y(o.value)),M=u(()=>y(p.value));function q(i,r,n){r.forEach(t=>{n[t.clique_leader_prefix]=n[t.clique_leader_prefix]||{},n[t.clique_leader_prefix][t.filename]=n[t.clique_leader_prefix][t.filename]||{},n[t.clique_leader_prefix][t.filename][t.prefix]=n[t.clique_leader_prefix][t.filename][t.prefix]||{},i in n[t.clique_leader_prefix][t.filename][t.prefix]||(n[t.clique_leader_prefix][t.filename][t.prefix][i]=0),n[t.clique_leader_prefix][t.filename][t.prefix][i]+=t.prefix_count}),console.log(n)}const j=u(()=>{const i={};return q("c1",L.value,i),q("c2",M.value,i),i}),E=u(()=>{const i=[],r=j.value;for(const n of Object.keys(r))for(const t of Object.keys(r[n]))for(const f of Object.keys(r[n][t])){const c=r[n][t][f].c1||0,a=r[n][t][f].c2||0,_=a-c;(s.value||_!=0)&&i.push({clique_leader_prefix:n,filename:t,prefix:f,c1:c,c2:a,diff:_,absolute_diff:Math.abs(_),percentage_diff:_/c*100})}return i.sort((n,t)=>t.absolute_diff-n.absolute_diff)}),V=u(()=>{const i=j.value,r={};for(const c of Object.keys(i))for(const a of Object.keys(i[c]))for(const _ of Object.keys(i[c][a])){const h=i[c][a][_].c1||0,O=i[c][a][_].c2||0;r[a]=r[a]||{c1:0,c2:0},r[a].c1+=h,r[a].c2+=O}const n=Object.keys(r).sort().map(c=>{const a=r[c].c1,_=r[c].c2,h=_-a;return{filename:c,c1:a,c2:_,diff:h,absolute_diff:Math.abs(h),percentage_diff:h/a*100}}),t=p.value.count_curies-o.value.count_curies,f=p.value.count_cliques-o.value.count_cliques;return[{filename:"Count of CURIEs in all files",c1:o.value.count_curies||0,c2:p.value.count_curies||0,diff:t,absolute_diff:Math.abs(t),percentage_diff:t/o.value.count_curies*100},{filename:"Count of cliques in all files",c1:o.value.count_cliques||0,c2:p.value.count_cliques||0,diff:p.value.count_cliques-o.value.count_cliques,absolute_diff:Math.abs(f),percentage_diff:f/o.value.count_cliques*100},...n]}),R={props:x,showIdentical:s,report1:m,report2:b,report1_json:o,report2_json:p,prefix_report_1_name:N,prefix_report_2_name:U,CliqueCount:k,report_to_clique_counts:y,clique_counts1:L,clique_counts2:M,add_clique_count_to_grouped:q,three_level_grouping:j,clique_count_rows:E,filename_count_rows:V};return Object.defineProperty(R,"__isScriptSetup",{enumerable:!1,value:!0}),R}}),z={class:"col-12"},G={class:"card"},H=e("div",{class:"card-header"},[e("strong",null,"Prefix Comparator Inputs")],-1),K={class:"card-body"},Q={class:"form-floating"},X=e("label",{for:"floatingTextarea"},"Prefix Report 1",-1),Y={class:"form-floating"},Z=e("label",{for:"floatingTextarea"},"Prefix Report 2",-1),$={class:"card my-2"},ee=e("div",{class:"card-header"},[e("strong",null,"Overall differences")],-1),te={class:"card-body p-0"},oe={class:"table"},ie=e("th",null,"Filename",-1),ne={style:{"text-align":"right"}},re={style:{"text-align":"right"}},le=e("th",{style:{"text-align":"right"}},"Diff",-1),se=e("th",{style:{"text-align":"right"}},"% Diff",-1),ae={style:{"text-align":"right"}},ce={style:{"text-align":"right"}},_e={style:{"text-align":"right"}},fe={style:{"text-align":"right"}},ue={class:"card my-2"},de=e("div",{class:"card-header"},[e("strong",null,"Differences by clique prefixes")],-1),pe={class:"card-body p-0"},he={class:"table"},xe=e("th",null,"Clique leader",-1),ge=e("th",null,"Filename",-1),ve=e("th",null,"Prefix",-1),me={style:{"text-align":"right"}},be={style:{"text-align":"right"}},ye=e("th",{style:{"text-align":"right"}},"Diff",-1),qe=e("th",{style:{"text-align":"right"}},"% Diff",-1),je={style:{"text-align":"right"}},Oe={style:{"text-align":"right"}},Se={style:{"text-align":"right"}},Ce={style:{"text-align":"right"}};function Pe(P,d,x,s,m,b){return g(),v("div",z,[e("div",G,[H,e("div",K,[e("div",Q,[S(e("textarea",{class:"form-control",style:{height:"10em"},placeholder:"Paste a prefix report here.",id:"prefixReport1","onUpdate:modelValue":d[0]||(d[0]=o=>s.report1=o)},null,512),[[D,s.report1]]),X]),e("div",Y,[S(e("textarea",{class:"form-control",style:{height:"10em"},placeholder:"Paste a second prefix report here.",id:"prefixReport2","onUpdate:modelValue":d[1]||(d[1]=o=>s.report2=o)},null,512),[[D,s.report2]]),Z]),e("div",null,[S(e("input",{type:"checkbox","onUpdate:modelValue":d[2]||(d[2]=o=>s.showIdentical=o)},null,512),[[T,s.showIdentical]]),w(" Show prefix counts that don't differ between the two versions. ")])])]),e("div",$,[ee,e("div",te,[e("table",oe,[e("thead",null,[e("tr",null,[ie,e("th",ne,l(s.prefix_report_1_name),1),e("th",re,l(s.prefix_report_2_name),1),le,se])]),e("tbody",null,[(g(!0),v(I,null,F(s.filename_count_rows,o=>(g(),v("tr",null,[e("td",null,l(o.filename),1),e("td",ae,l(o.c1.toLocaleString()),1),e("td",ce,l(o.c2.toLocaleString()),1),e("td",_e,l((o.diff>0?"+":"")+o.diff.toLocaleString()),1),e("td",fe,l(o.percentage_diff.toFixed(2)+"%"),1)]))),256))])])])]),e("div",ue,[de,e("div",pe,[e("table",he,[e("thead",null,[e("tr",null,[xe,ge,ve,e("th",me,l(s.prefix_report_1_name)+" (contains "+l((s.report1_json.count_curies||0).toLocaleString())+" CURIEs)",1),e("th",be,l(s.prefix_report_2_name)+" (contains "+l((s.report2_json.count_curies||0).toLocaleString())+" CURIEs)",1),ye,qe])]),e("tbody",null,[(g(!0),v(I,null,F(s.clique_count_rows,o=>(g(),v("tr",null,[e("td",null,l(o.clique_leader_prefix),1),e("td",null,l(o.filename),1),e("td",null,l(o.prefix),1),e("td",je,l(o.c1.toLocaleString()),1),e("td",Oe,l(o.c2.toLocaleString()),1),e("td",Se,l((o.diff>0?"+":"")+o.diff.toLocaleString()),1),e("td",Ce,l(o.percentage_diff.toFixed(2)+"%"),1)]))),256))])])])])])}const Me=A(W,[["render",Pe]]);export{Me as default};
